mapboxgl.accessToken = 'pk.eyJ1Ijoia2VubmVkeTI1NCIsImEiOiJjazU1azYyczIwYXpwM25wbTJlOG9rcndkIn0.UjLXXvYXcGK0cHY6I23Brw';
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    zoom: 5.3,
    center: [37.40588083324894, 0.0250977358123379]

});



// http://geojson.io/#map=8/3.798/40.545
// fetch data from API
async function getCovid() {
    const response = await fetch('/covid1')
    const data = await response.json()

    const covid = data.data.map((cov) => {
        return {
            type: 'Feature',
            geometry: {
                type: 'Point',
                coordinates: cov.location.coordinates[0]

            },
            properties: {
                countyCode: cov.countyCode

            }
        }
    })

    loadMap(covid)
    console.log(data)
    console.log(data.data[0].location)
    console.log(data.data[0].location.coordinates[0])
}


// load map with points
function loadMap() {

    map.on('load', function() {
        map.addSource('maine', {
            'type': 'geojson',
            'data': {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": {
                            "stroke": "#6dd12b",
                            "stroke-width": 2,
                            "stroke-opacity": 1,
                            "fill": "#7ff215",
                            "fill-opacity": 0.5
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [
                                [
                                    [
                                        39.84466552734375,
                                        3.803965054420254
                                    ],
                                    [
                                        39.822692871093764,
                                        3.8204080831949283
                                    ],
                                    [
                                        39.83367919921874,
                                        3.7655967694198504
                                    ],
                                    [
                                        39.79110717773441,
                                        3.7505230509601346
                                    ],
                                    [
                                        39.784584045410185,
                                        3.5500868119684656
                                    ],
                                    [
                                        39.78492736816409,
                                        3.3496070622546568
                                    ],
                                    [
                                        39.8968505859375,
                                        3.285856062323656
                                    ],
                                    [
                                        40.023193359375,
                                        3.236497648345289
                                    ],
                                    [
                                        40.28961181640624,
                                        2.9540126939036564
                                    ],
                                    [
                                        40.484619140625,
                                        2.868978563877516
                                    ],
                                    [
                                        40.517578125,
                                        2.740043847609629
                                    ],
                                    [
                                        40.50384521484374,
                                        2.70712209411511
                                    ],
                                    [
                                        40.5230712890625,
                                        2.6604814147587383
                                    ],
                                    [
                                        40.58486938476563,
                                        2.5260367521718403
                                    ],
                                    [
                                        40.62057495117187,
                                        2.4505769697617588
                                    ],
                                    [
                                        40.726318359375,
                                        2.331204680180623
                                    ],
                                    [
                                        40.86639404296874,
                                        2.237895124716353
                                    ],
                                    [
                                        40.93505859375,
                                        2.1775151734461176
                                    ],
                                    [
                                        40.98175048828125,
                                        2.1747705722118864
                                    ],
                                    [
                                        40.989990234375,
                                        2.819600993200333
                                    ],
                                    [
                                        41.3360595703125,
                                        3.167940314402757
                                    ],
                                    [
                                        41.8894958496094,
                                        3.969750997677027
                                    ],
                                    [
                                        41.1753845214844,
                                        3.9587909559445453
                                    ],
                                    [
                                        41.07238769531251,
                                        4.034138291548399
                                    ],
                                    [
                                        40.984497070312514,
                                        4.119066903428982
                                    ],
                                    [
                                        40.91308593750001,
                                        4.157418800193693
                                    ],
                                    [
                                        40.83343505859376,
                                        4.250551318687768
                                    ],
                                    [
                                        40.76477050781251,
                                        4.2861578513210015
                                    ],
                                    [
                                        40.36102294921875,
                                        4.102629809278488
                                    ],
                                    [
                                        39.90097045898441,
                                        3.9149493420999275
                                    ],
                                    [
                                        39.84466552734375,
                                        3.803965054420254
                                    ]
                                ]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "stroke": "#555555",
                            "stroke-width": 2,
                            "stroke-opacity": 1,
                            "fill": "#f9f530",
                            "fill-opacity": 0.5
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [
                                [
                                    [
                                        33.9642333984375,
                                        4.231377888253547
                                    ],
                                    [
                                        34.9365234375,
                                        2.4492049339511506
                                    ],
                                    [
                                        35.1177978515625,
                                        2.6522505226124395
                                    ],
                                    [
                                        35.3924560546875,
                                        1.9277367801405985
                                    ],
                                    [
                                        35.7879638671875,
                                        1.6641946615712557
                                    ],
                                    [
                                        36.298828125,
                                        1.0051974541602744
                                    ],
                                    [
                                        36.38671875,
                                        0.9447814006874024
                                    ],
                                    [
                                        36.309814453125,
                                        1.5818302639606454
                                    ],
                                    [
                                        36.67236328125,
                                        2.3174830687583046
                                    ],
                                    [
                                        36.3427734375,
                                        2.67968661580376
                                    ],
                                    [
                                        36.14501953125,
                                        2.9759559359447683
                                    ],
                                    [
                                        36.10107421875,
                                        3.2063329870791444
                                    ],
                                    [
                                        35.79345703125,
                                        3.601142320158735
                                    ],
                                    [
                                        35.9033203125,
                                        4.576424935853651
                                    ],
                                    [
                                        34.365234375,
                                        4.620228796979006
                                    ],
                                    [
                                        33.9642333984375,
                                        4.231377888253547
                                    ]
                                ]
                            ]
                        }
                    }
                ]
            }
        });
        map.addLayer({
            'id': 'maine',
            'type': 'fill',
            'source': 'maine',
            'layout': {},
            'paint': {
                'fill-color': '#088',
                'fill-opacity': 0.8
            }
        });
    });

}


getCovid()